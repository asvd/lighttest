<html>
  <head>
    <link href="favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="bitstream.css" />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <link rel="stylesheet" type="text/css" href="hl/style.css" />
    <script type="text/javascript" src="hl/hl-all.js"></script>
    <title>Lighttest, a clear testing environment</title>
  </head>

    <body onload="DlHighlight.HELPERS.highlightByName('code', 'pre')">




<table class="pad" cellspacing=0 cellpadding=0 border=0>
  <tr>
    <td>
      <img src="logo_webpage.png" width=32 height=32/>
    </td>
    <td>
      <h1>Lighttest &mdash; a clear testing environment</h1>
    </td>
  </tr>
</table>




      <p class="download">
        <a href="https://github.com/asvd/lighttest/releases/download/v0.1.0/lighttest-0.1.0-bundled.tar.gz">lighttest-0.1.0-bundled.tar.gz</a>
        6&nbsp;kb 
        <br/>
        <a href="https://github.com/asvd/lighttest">https://github.com/asvd/lighttest</a>
      </p>
<p>
Lighttest is a JavaScript unit-testing library &mdash; it works both
in browsers and under Node.js, supports flow control, and is focused
on keeping the tests clear. This is achieved with a minimal syntax of
the test cases, and the only testing function,
<span class=inline_code>lighttest.check()</span>, used to indicate a
success or a failure. As shown below, any testing behaviour could be
implemented using that function and the native means of JavaScript. As
result, one can easily understand or prepare the exact process
performed by a test without a need to involve some additional testing
API.
</p>

<h2>Installation</h2>

<ul>
  <li>
    <p>
    For <a href="http://asvd.github.io/helios-kernel/">Helios
    Kernel</a> (upon both Node.js and browser-based environments)
    &mdash; no installation required, simply include the library in
    the module head:
    </p>

    <pre name="code" class="js">include('http://asvd.github.io/lighttest/lighttest-0.1.0.js');
    </pre>

    <p>
    Optionally you may 
    <a href="https://github.com/asvd/lighttest/releases/download/v0.1.0/lighttest-0.1.0.tar.gz">download
    the distribution</a>, unpack it, and include the library locally.
    </p>
  </li>
  <li>
    <p>
      For the plain Node.js &mdash; using npm:
    </p>

    <pre class="sh"><span class='green'>$</span> npm install lighttest</pre>

    <p>
    and then in your code:
    </p>

    <pre name="code" class="js">var lighttest = require('lighttest');
    </pre>
  </li>
  <li>
    <p>
    Anywhere else &mdash; download the Lighttest
    <a href="https://github.com/asvd/lighttest/releases/download/v0.1.0/lighttest-0.1.0-bundled.tar.gz">bundle</a>,
    unpack it and then load
    the <span class=inline_code>lighttest.js</span> in any suitable way:
    the bundle is a plain JavaScript file simply declaring the global
    <span class=inline_code>lighttest</span> object.
    </p>
  </li>
</ul>


<h2>Usage</h2>

<p>
Testing process is launched using
the <span class=inline_code>lighttest.start()</span> function, the
only argument to provide is an object containing a set of tests cases:
</p>

<pre name="code" class="js">lighttest.start({
    'Some test': function() {
        // test case code
        ...
    },


    'Another test': function() {
        // another test case code
        ...
    },

    ...
});
</pre>

<p>
The test cases object is key-based, where the key is a test label, and
the value is a function to perform during the test. The code given
above should result into an output like this:
</p>

<pre class="sh">
Some test  <span class=green>PASS</span>
Another test  <span class=green>PASS</span>

2 tests <span class=green>PASSED</span>
</pre>

<p>
Inside the test case, two other functions are available:
</p>

<p>
 <span class=inline_code>lighttest.check()</span> &mdash; verifies the given
 value against being true;
<br/>
 <span class=inline_code>lighttest.done()</span> &mdash; notifies that the
 current test case is over.
</p>

<p>
Therefore a code of a single test case may look like this:
</p>

<pre name="code" class="js">
    ...

    'Check if something works':
    function() {
        var result = something.shouldWork();
        lighttest.check(result);
        lighttest.done();
    },

    ...
</pre>


<p>
If a value given to
the <span class=inline_code>lighttest.check()</span> function casts to
true, it will result into a green <span class=green>PASS</span> label
on the output, otherwise the red <span class=red>FAIL</span> label
will be displayed.
</p>

<p>
A single test may call
the <span class=inline_code>lighttest.check()</span> function as many
times as needed thus performing several checks for a single test
case. The whole test case is considered as failed if at least one
check has failed.
</p>

<p>
The value provided to
the <span class=inline_code>lighttest.check()</span> function is the
only thing regarded by Lighttest in sence of recognizing a success or
a failure. This approach makes condition specifying clear, and allows
to see what exactly is performed and checked during the
test. Particullary this means that exceptions are not treated as a
failure. If a check against exception is needed, it should be
performed explicitly:
</p>


<pre name="code" class="js">
    ...

    'Check if a code runs without exceptions':
    function() {
        var exception = null;
        try {
            something.shouldRunWithoutExceptions();
        } catch (e) {
            exception = e;
        }

        if (!exception) {
            lighttest.check(true);
            lighttest.done();
        } else {
            lighttest.check(false);

            // issuing asynchroniously since throwing breaks the stack
            setTimeout(lighttest.done, 10);
            throw exception;
        }
    },


    'Check if a code throws an exception':
    function() {
        var exception = null;
        try {
            something.shouldThrowAnException();
        } catch (e) {
            exception = e;
        }

        if (exception) {
            lighttest.check(true);
            setTimeout(lighttest.done, 10);
            throw exception;
        } else {
            lighttest.check(false);
            lighttest.done();
        }
    },


    ...
</pre>

<p>
After the <span class=inline_code>lighttest.done()</span> function is
issued, Lighttest will proceed to the next test case. As shown in the
code above, it could be issued after some time, which makes it
possible to test some callback-based stuff:
</p>

<pre name="code" class="js">
    ...

    'Check if something asynchronious works fine':
    function() {
        var successCb = function() {
            lighttest.check(true);
            lighttest.done();
        }

        var failureCb = function() {
            lighttest.check(false);
            lighttest.done();
        }

        doSomethingAsynchronious(successCb, failureCb);
    },

    
    ...
</pre>

<p>
After all tests are processed, Lighttest will display the overall
number of the tested cases, and exit with an error code equalling the
number of failed tests (if performed under Node.js).
</p>

<p>
Optional callback could also be given to the
<span class=inline_code>lighttest.start()</span> function. It will be
issued after all tests are completed, the number of failed tests will
be provided as an argument:
</p>

<pre name="code" class="js">
var tests = {
    // set of tests
    ...
}

var finalize = function(failedCount) {
    // perform the cleanup or report the result
    ...
}

lighttest.start(tests, finalize);
</pre>

<p>
When performed in the browser-based environment, Lighttest will take
over the whole browser window by default. Optionally the output may be
redirected to a particular node on the webpage. To do this, such node
should be designated
with <span class=inline_code>id="lighttest"</span>. The node will be
searched for upon the first call of
the <span class=inline_code>lighttest.start()</span> function, and if
not found, Lighttest will fill the whole page. Output redirect may be
useful to perform the tests inside a live frotend application.
</p>


<h2>Flow control</h2>

<p>
Another feature designed for running the tests in a GUI-driven
environment is a flow control. When performing the tests inside a live
application during development, it may be useful to interrupt the
testing process or even to restart it completely.
</p>

<!-- image goes here -->

<p>
To interrupt the process, one should call
the <span class=inline_code>lighttest.pause()</span> function. It will
then wait until the current test case is completed (since there could
be some upcoming callbacks), and interrupt the execution
afterwards. To continue running the tests, call
the <span class=inline_code>lighttest.pause()</span> again.
</p>

<p>
To restart the tests,
the <span class=inline_code>lighttest.start()</span> function should
be called again with the same arguments (optionally a different set of
tests may be provided). Similarry it will wait until the currently
running test case is over.
</p>

<p>
It is assumed that there are some buttons on the screen
issuing <span class=inline_code>lighttest.start()</span>
and <span class=inline_code>lighttest.pause()</span> functions, but it
may also be convenient to call the
the <span class=inline_code>lighttest.pause()</span> right inside the
test case code to interrupt the execution after that test (but in this
case there should certainly be a pause button, otherwise it will not
be possible to continue the process).
</p>


<h2>Example</h2>


 <p>
The following example shows a set of tests implemented as
a <a href="http://asvd.github.io/helios-kernel/">Helios Kernel</a>
module:
</p>

<pre name="code" class="js">
include('http://asvd.github.io/lighttest/lighttest-0.1.0.js');

init = function() {
    lighttest.start({
        'Math.sqrt() function test':
        function() {
            var calculated = Math.sqrt(4);
            var expected = 2;
            lighttest.check(calculated == expected);

            lighttest.done();
        },


        'Callback-based test for setTimeout()':
        function() {
            var callback = function() {
                lighttest.check(true);
                lighttest.done();
            }

            setTimeout(callback, 100);
        },


        'Test with several checks':
        function() {
            lighttest.check( 2*2 == 4 );
            lighttest.check( 3*3 == 9 );
            lighttest.done();
        },


        'Test with intentional failed check':
        function() {
            lighttest.check( 2*2 == 4 );
            lighttest.check( 2*2 == 5 );
            lighttest.done();
        },
        

        'Test with checks against undefined':
        function() {
            var a = { b : 1 };
            lighttest.check( typeof(a.b) != 'undefined' );
            lighttest.check( typeof(a.c) == 'undefined' );
            lighttest.check( typeof(a) != 'undefined' );
            lighttest.check( typeof(noSuchVar) == 'undefined' );
            lighttest.done();
        },
        

        'Test with checks against strict equality':
        function() {
            var a = false;
            var b = 0;
            lighttest.check( a == b );
            lighttest.check( a !== b );
            lighttest.done();
        }
    });

}
</pre>

<p>
The given code produces the following output:
</p>

<pre class="sh">
Math.sqrt() function test  <span class=green>PASS</span> 
Callback-based test for setTimeout()  <span class=green>PASS</span> 
Test with several checks  <span class=green>PASS</span> <span class=green>PASS</span> 
Test with intentional failed check  <span class=green>PASS</span> <span class=red>FAIL</span> 
Test with checks against undefined  <span class=green>PASS</span> <span class=green>PASS</span> <span class=green>PASS</span> <span class=green>PASS</span> 
Test with checks against strict equality  <span class=green>PASS</span> <span class=green>PASS</span>

1 of 6 tests <span class=red>FAILED</span> 
</pre>

<br/>
<br/>

<table class="pad" cellspacing=0 cellpadding=0 border=0>
  <tr>
    <td>
      <table cellspacing=0 cellpadding=0 border=0>
        <tr><td height=34><img src="cc.png" width=32 height=32/></td></tr>
        <tr><td height=32><img src="by.png" width=32 height=32/></td></tr>
      </table>
    </td>
    <td>
            <p class="copy">
            Lighttest library is licensed under the MIT license, see
            <a href=http://github.com/asvd/lighttest>http://github.com/asvd/lighttest</a>
            <br/> Content of this page is licensed under the Creative
            Commons Attribution 3.0 Unported License.  <br/> To view a
            copy of this license, visit
            <a href=http://creativecommons.org/licenses/by/3.0/>http://creativecommons.org/licenses/by/3.0/</a>
            <br/> or send a letter to Creative Commons, <br/> 171
            Second Street, Suite 300, San Francisco, California,
            94105, USA.
            </p>
    </td>
  </tr>
</table>


    
  </body>
</html>
